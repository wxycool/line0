/*! my-project-name - v0.0.1 - 2014-11-07 */

myCtrl.controller("PromotionCtrl",["$scope",function(a){a.pageClass="promotion",a.title="优惠专区"}]),myCtrl.controller("PromotionMainCtrl",["$scope","$http","$window",function(a,b,c){function d(){var a="http://handset.line0.com/ws/handset/v3/mcms/promotion?jsonp=getPromotion",c={params:{userX:longitude,userY:latitude,cityId:cityId,toPage:1,pageRows:10}};b.jsonp(a,c).success()}function e(){if(a.curPage=parseInt(a.curPage)+1,a.curPage>a.totalPage)return g.className="show",g.innerHTML="没有更多数据了",myScrollHot.refresh(),void(f=0);var c="http://handset.line0.com/ws/handset/v3/mcms/promotion?jsonp=getMorePromotion",d={params:{userX:longitude,userY:latitude,cityId:cityId,toPage:a.curPage,pageRows:10}};b.jsonp(c,d).success()}var f=0,g=document.getElementById("shop-list-pullDown");a.StatePromotionMain=!1,a.StatePromotionRefresh=!0,getLocation(d),c.getPromotion=function(b){if(0==b.response.size)d();else{imgLen=0;for(var c=0;c<b.response.shopList.length;c++)imgLen+=b.response.shopList[c].productList.length>3?3:b.response.shopList[c].productList.length;a.promotions=b.response.shopList,a.curPage=b.response.page.curPage,a.totalPage=b.response.page.pageAmount,a.StatePromotionMain=!0,a.StatePromotionRefresh=!1}},$.getScript("lib/other/iscroll-probe.min.js",function(){myScrollOne=new IScroll("#scroller",{tap:!0,preventDefault:!1,probeType:2}),document.addEventListener("touchmove",function(a){a.preventDefault()},!1)}),c.getMorePromotion=function(b){if(0==b.response.size)e();else{imgLen=0;for(var c=0;c<b.response.shopList.length;c++)imgLen+=b.response.shopList[c].productList.length>3?3:b.response.shopList[c].productList.length;a.promotions=a.promotions.concat(b.response.shopList)}},a.$on("ngRepeatFinished",function(){$.getScript("lib/other/iscroll-probe.min.js",function(){$(".spin_refresh").hide(),g.className="",g.innerHTML="下拉准备刷新...",f=0,myScrollOne.refresh(),myScrollOne.on("scroll",function(){0!=f||g.className.match("show|loading")||this.y>5||this.y<this.maxScrollY-5&&(g.className="show",myScrollOne.refresh(),f=1)}),myScrollOne.on("scrollEnd",function(){1==f&&g.className.match("show|loading")&&(g.className="loading",g.innerHTML='<i class="icon-spin animate-spin"></i>',f=2,e())})})})}]);