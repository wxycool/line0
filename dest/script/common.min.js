// JavaScript Document
"use strict";

function trim(a) {
    return a.replace(/^\s+|\s+$/g, "");
}

function init() {}

//getLocation();
function getLocation(a) {
    //console.log(latitude, longitude, cityId);
    null != latitude && null != longitude && null != cityId ? //都有值
    //console.log(0);
    a && "function" == typeof a && a() : (latitude = cookie.get("latitude"), longitude = cookie.get("longitude"), 
    cityId = cookie.get("cityId"), //console.log(latitude, longitude, cityId);
    null != latitude && null != longitude && null != cityId ? //cookie都有值
    //console.log(1);
    a && "function" == typeof a && a() : //console.log(2);
    getLocationFromBaidu(a));
}

/**
	 * TODO:GPS定位
	 */
function getLocationFromBaidu(a) {
    var b = new BMap.Geolocation();
    b.getCurrentPosition(function(b) {
        if (this.getStatus() == BMAP_STATUS_SUCCESS) {
            latitude = b.point.lat, longitude = b.point.lng, //console.log(latitude, longitude);
            //32.0572355 118.77807441
            cookie.set("latitude", latitude), cookie.set("longitude", longitude);
            var c = new BMap.Geocoder();
            c.getLocation(b.point, function(b) {
                var c = b.addressComponents.city;
                switch (c) {
                  case "南京市":
                    cityId = 1, cookie.set("cityId", 1);
                    break;

                  case "上海市":
                    cityId = 5, cookie.set("cityId", 5);
                    break;

                  case "苏州市":
                    cityId = 2, cookie.set("cityId", 2);
                }
                //console.log(cityId, rs.address);
                a && "function" == typeof a && a();
            });
        } else alert("failed" + this.getStatus());
    }, {
        enableHighAccuracy: !0
    });
}

/**
 * TODO:图片预加载
 */
function loadImage(a, b) {
    var c = new Image();
    //console.log(img);
    //创建一个Image对象，实现图片的预下载
    //console.log(img);
    // 如果图片已经存在于浏览器缓存，直接调用回调函数
    return c.src = a, c.complete ? void b.call(c) : (c.onload = function() {
        //图片下载完毕时异步调用callback函数。
        b.call(c);
    }, void (c.onerror = function() {
        //img.src = 'http://img.line0.com/newimg/image/403/CCDF01005.jpg_200x.jpg';
        b.call(c);
    }));
}

var myScrollIndex, myScrollSearch, myScrollCate, myScrollStoreLeft, myScrollStoreRight, myScrollStored, myScrollGoods, myScrollHot, waterfallImgIndex = 0, waterfallImgLen = 0, cityId = null, latitude = null, longitude = null;

$(document).ready(function() {}), window.onload = init;

/**
 * TODO:Cookie
 */
/*
	cookie.set('_cityid', 'nj');
 */
var cookie = {
    get: function(a) {
        var b = document.cookie.match(new RegExp("(^| )" + a + "=([^;]*)(;|$)"));
        return null != b ? unescape(b[2]) : null;
    },
    set: function(a, b, c) {
        var d = c || 1, e = new Date();
        e.setTime(e.getTime() + 60 * d * 60 * 1e3), document.cookie = a + "=" + escape(b) + ";path=/;expires=" + e.toGMTString();
    }
};