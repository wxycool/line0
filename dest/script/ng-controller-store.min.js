/*! my-project-name - v0.0.1 - 2014-11-07 */

myCtrl.controller("StoreCtrl",["$scope","$rootScope","$http","$window","$stateParams",function(a,b,c,d,e){function f(){var a="http://handset.line0.com/ws/handset/v2/shop/shopDetail?jsonp=getStore&clientFlag=line0123456789abcdef987opqxyzline0&cityId="+cityId+"&userX="+longitude+"&userY="+latitude+"&shopId="+e.sid;c.jsonp(a).success()}a.pageClass="store",a.title="",b.storeId=e.sid,a.StateStoreTop=!1,a.StateStoreMain=!1,a.StateStoreRefresh=!0,getLocation(f),d.getStore=function(e){var f=document.getElementById("scroller-left"),g=document.getElementById("scroller-right");if(a.store=e.response.shop,a.cate=e.response.shopProdTypeList,a.tj=e.response.tuijianProdList,a.prod=[],a.cateTypeId=[],a.bill={},1!==e.response.errorCode&&alert(e.response.msg),void 0!==a.tj[0].productName){for(var h=JSON.parse('{"typeName": "热销推荐", "typeId": "0000"}'),i=0;i<a.tj.length;i++)a.tj[i].shopProdTypeId="0000",a.tj[i].buyNum=0;a.cate=[h].concat(a.cate),a.prod=a.prod.concat(a.tj)}else a.tj=null;for(var j=a.prod,i=0;i<a.cate.length;i++)if("0000"!==a.cate[i].typeId){var k="http://handset.line0.com/ws/handset/v2/shop/productList?jsonp=getStoreCate&clientFlag=line0123456789abcdef987opqxyzline0&shopId="+b.storeId+"&shopProdTypeId="+a.cate[i].typeId;c.jsonp(k).success()}d.getStoreCate=function(b){for(var c in b.response.productMap){for(var d=0;d<b.response.productMap[c].length;d++)b.response.productMap[c][d].buyNum=0;j=j.concat(b.response.productMap[c])}a.prod=j;var e=function(){for(var b=0,c=0,d=a.prod.length;d>c;c++)b=parseFloat(b)+parseFloat(a.prod[c].priceDown)*parseFloat(a.prod[c].buyNum);a.bill.totalCart=b,a.bill.discount=b};a.$watch("prod",e,!0)},a.StateStoreTop=!0,a.StateStoreMain=!0,a.StateStoreRefresh=!1,a.StateNotice=!1,a.stockCart=!0,a.stockSelect=!1,$.getScript("lib/other/iscroll-probe.min.js",function(){myScrollStoreLeft=new IScroll("#scroller-left",{tap:!0,preventDefault:!0}),myScrollStoreRight=new IScroll("#scroller-right",{tap:!0,preventDefault:!0,preventDefaultException:{tagName:/^(A|INPUT|TEXTAREA|BUTTON|SELECT)$/}}),document.addEventListener("touchmove",function(a){a.preventDefault()},!1)}),0!==a.store.promotionInfo.length&&(a.StateNotice=!0,f.className="up",g.className="up"),a.hideNotice=function(){a.StateNotice=!1,f.className="",g.className="",myScrollStoreLeft.refresh(),myScrollStoreRight.refresh()}}}]),myCtrl.controller("StoreMainCtrl",["$scope","$rootScope","$http","$window","$stateParams",function(){}]);