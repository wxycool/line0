/*! my-project-name - v0.0.1 - 2014-11-07 */

myCtrl.controller("CateCtrl",["$scope","$rootScope","$http","$window",function(a){a.pageClass="cate",a.title="商家分类"}]),myCtrl.controller("CateNavCtrl",["$scope","$rootScope","$http","$window","$state","$stateParams",function(a,b,c,d,e,f){b.cateDistanceText=void 0==b.cateDistanceText?"距离范围":b.cateDistanceText,b.cateCidText=void 0==b.cateCidText?"商家分类":b.cateCidText,b.cateSortText=void 0==b.cateSortText?"选择排序":b.cateSortText,a.cateInit=function(){a.CateMask=!1,a.CateDistanceList=!1,a.CateCidList=!1,a.CateSortList=!1,a.cateDistanceClass="",a.cateCidClass="",a.cateSortClass=""},a.cateInit(),a.CateDistanceClick=function(){a.CateDistanceList!==!0?(a.cateInit(),a.CateMask=!0,a.CateDistanceList=!0,a.cateDistanceClass="icon-down02"):a.cateInit()},a.CateCidClick=function(){a.CateCidList!==!0?(a.cateInit(),a.CateMask=!0,a.CateCidList=!0,a.cateCidClass="icon-down02"):a.cateInit()},a.CateSortClick=function(){a.CateSortList!==!0?(a.cateInit(),a.CateMask=!0,a.CateSortList=!0,a.cateSortClass="icon-down02"):a.cateInit()},a.CateDistanceClick3000=function(){b.distance=3e3,b.cateDistanceText="3.0km内 运费6元",e.go("cate",f,{reload:!0})},a.CateDistanceClick4500=function(){b.distance=4500,b.cateDistanceText="4.5km内 运费10元",e.go("cate",f,{reload:!0})},a.CateDistanceClick6000=function(){b.distance=6e3,b.cateDistanceText="6.0km内 运费15元",e.go("cate",f,{reload:!0})},a.CateCidClick0=function(){b.cid=0,b.cateCidText="全部",e.go("cate",f,{reload:!0})},a.CateCidClick1=function(){b.cid=1,b.cateCidText="中式餐厅",e.go("cate",f,{reload:!0})},a.CateCidClick2=function(){b.cid=2,b.cateCidText="馄饨面食",e.go("cate",f,{reload:!0})},a.CateCidClick3=function(){b.cid=3,b.cateCidText="便当套餐",e.go("cate",f,{reload:!0})},a.CateCidClick4=function(){b.cid=4,b.cateCidText="西式餐点",e.go("cate",f,{reload:!0})},a.CateCidClick5=function(){b.cid=5,b.cateCidText="日韩料理",e.go("cate",f,{reload:!0})},a.CateCidClick6=function(){b.cid=6,b.cateCidText="下午茶",e.go("cate",f,{reload:!0})},a.CateCidClick7=function(){b.cid=7,b.cateCidText="休闲小吃",e.go("cate",f,{reload:!0})},a.CateSortClick0=function(){b.sort=0,b.cateSortText="默认排序",e.go("cate",f,{reload:!0})},a.CateSortClick1=function(){b.sort=1,b.cateSortText="距离由近到远",e.go("cate",f,{reload:!0})},a.CateSortClick2=function(){b.sort=2,b.cateSortText="距离由远到近",e.go("cate",f,{reload:!0})},a.CateSortClick3=function(){b.sort=3,b.cateSortText="起送价由低到高",e.go("cate",f,{reload:!0})},a.CateSortClick4=function(){b.sort=4,b.cateSortText="起送价由高到低",e.go("cate",f,{reload:!0})},a.CateSortClick5=function(){b.sort=5,b.cateSortText="店家配送优先",e.go("cate",f,{reload:!0})},a.CateSortClick6=function(){b.sort=6,b.cateSortText="零号线配送优先",e.go("cate",f,{reload:!0})}}]),myCtrl.controller("CateMainCtrl",["$scope","$rootScope","$http","$window",function(a,b,c,d){function e(){var a="http://handset.line0.com/ws/handset/v3/shop/shopList?jsonp=getShopList&cityId="+cityId+"&userX="+longitude+"&userY="+latitude+"&toPage=1&pageRows=20&shopType="+b.cid+"&distance="+b.distance+"&sort="+b.sort;c.jsonp(a).success()}function f(){if(a.curPage=parseInt(a.curPage)+1,a.curPage>a.totalPage)return g.className="show",g.innerHTML="没有更多数据了",myScrollCate.refresh(),void(h=0);var d="http://handset.line0.com/ws/handset/v3/shop/shopList?jsonp=getMoreShopByPage&cityId="+cityId+"&userX="+longitude+"&userY="+latitude+"&toPage="+a.curPage+"&pageRows=20&shopType="+b.cid+"&distance="+b.distance+"&sort="+b.sort;c.jsonp(d).success()}b.cid=void 0==b.cid?0:b.cid,b.distance=void 0==b.distance?3e3:b.distance,b.sort=void 0==b.sort?0:b.sort;var g=(document.getElementById("shop-list-pullUp"),document.getElementById("shop-list-pullDown")),h=0;d.getShopList=function(b){a.shopList=b.response.shopList,a.shopPage=b.response.page,a.totalRow=a.shopPage.totalRows,a.curPage=a.shopPage.curPage,a.totalPage=a.shopPage.pageAmount,1===a.shopList.length&&void 0==a.shopList[0].shopId&&(a.shopList=null,a.cateListEmpty=!0,a.show_error="米有找到相关的店铺"),a.StateCateRefresh=!1,$.getScript("lib/other/iscroll-probe.min.js",function(){myScrollCate=new IScroll("#scroller",{tap:!0,preventDefault:!1,probeType:2}),document.addEventListener("touchmove",function(a){a.preventDefault()},!1),myScrollCate.on("scroll",function(){0!=h||g.className.match("show|loading")||this.y>5||this.y<this.maxScrollY-5&&(g.className="show",myScrollCate.refresh(),h=1)}),myScrollCate.on("scrollEnd",function(){1==h&&g.className.match("show|loading")&&(g.className="loading",g.innerHTML='<i class="icon-spin animate-spin"></i>',h=2,f())})})},d.getMoreShopByPage=function(b){a.shopList=a.shopList.concat(b.response.shopList),$.getScript("lib/other/iscroll-probe.min.js",function(){g.className="",g.innerHTML="下拉准备刷新...",myScrollCate.refresh(),h=0})},a.cateListExist=!0,a.cateListEmpty=!1,a.StateCateRefresh=!0,getLocation(e)}]);