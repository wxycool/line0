/*! my-project-name - v0.0.1 - 2014-11-05 */

!function(a){function b(a){h(function(){var b,c;for(b=0;b<a.length;b++)c=a[b],c.obj.css(c.css)})}function c(b){return a.trim(b).toLowerCase()}var d,e,f,g=a(window);d=function(a,b){return function(){return a.apply(b,arguments)}},e={container:a("body"),align:"center",direction:void 0,comparator:null,outerOffset:0,itemWidth:0,flexibleWidth:0,offset:2,verticalOffset:void 0,fillEmptySpace:!0,onLayoutChanged:void 0,autoResize:!0,resizeDelay:50,ignoreInactiveItems:!0,possibleFilters:[]};var h=window.requestAnimationFrame||function(a){a()};f=function(){function f(b,c){this.itemHeightsDirty=!0,this.handler=b,this.resizeTimer=null,this.columns=null,this.placeholders=[],this.activeItemCount=0,a.extend(!0,this,e,c),this.verticalOffset=this.verticalOffset||this.offset,this.updateFilterClasses=d(this.updateFilterClasses,this),this.filter=d(this.filter,this),this.onResize=d(this.onResize,this),this.onRefresh=d(this.onRefresh,this),this.update=d(this.update,this),this.layout=d(this.layout,this),this.getItemWidth=d(this.getItemWidth,this),this.getActiveItems=d(this.getActiveItems,this),this.layoutFull=d(this.layoutFull,this),this.layoutColumns=d(this.layoutColumns,this),this.sortElements=d(this.sortElements,this),this.refreshPlaceholders=d(this.refreshPlaceholders,this),this.clear=d(this.clear,this),this.updateFilterClasses(),this.autoResize&&g.bind("resize.wookmark",this.onResize),this.container.bind("refreshWookmark",this.onRefresh)}return f.prototype.updateFilterClasses=function(){for(var a,b,d,e,f=0,g=0,h=0,i={},j=this.possibleFilters;f<this.handler.length;f++)if(a=this.handler.eq(f),b=a.data("filterClass"),"object"==typeof b&&b.length>0)for(g=0;g<b.length;g++)d=c(b[g]),"undefined"==typeof i[d]&&(i[d]=[]),i[d].push(a[0]);for(;h<j.length;h++)e=c(j[h]),e in i||(i[e]=[]);this.filterClasses=i},f.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!==this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},f.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},f.prototype.update=function(b){this.itemHeightsDirty=!0,a.extend(!0,this,b)},f.prototype.layout=function(a){if(this.container.is(":visible")){var b,c=0,d=0,e=0,f=parseFloat(this.getItemWidth())+this.offset,g=this.container.width(),h=g-2*this.outerOffset,i=~~((h+this.offset)/f),j=this.getActiveItems(),k=j.length;if(this.itemHeightsDirty||!this.container.data("itemHeightsInitialized")){for(;k>e;e++)b=j.eq(e),b.data("wookmark-height",b.outerHeight());this.itemHeightsDirty=!1,this.container.data("itemHeightsInitialized",!0)}i=Math.max(1,Math.min(i,k)),c=this.outerOffset,"center"==this.align&&(c+=~~(.5+(h-(i*f-this.offset))>>1)),this.direction=this.direction||("right"==this.align?"right":"left"),d=a||null===this.columns||this.columns.length!=i||this.activeItemCount!=k?this.layoutFull(f,i,c):this.layoutColumns(f,c),this.activeItemCount=k,this.container.css("height",d),this.fillEmptySpace&&this.refreshPlaceholders(f,c),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},f.prototype.getItemWidth=function(){var a=this.itemWidth,b=this.container.width()-2*this.outerOffset,c=this.handler.eq(0),d=this.flexibleWidth;if(void 0===this.itemWidth||0===this.itemWidth&&!this.flexibleWidth?a=c.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(a=parseFloat(this.itemWidth)/100*b),d){"string"==typeof d&&d.indexOf("%")>=0&&(d=parseFloat(d)/100*b);var e=b+this.offset,f=~~(.5+e/(d+this.offset)),g=~~(e/(a+this.offset)),h=Math.max(f,g),i=Math.min(d,~~((b-(h-1)*this.offset)/h));a=Math.max(a,i),this.handler.css("width",a)}return a},f.prototype.getActiveItems=function(){return this.ignoreInactiveItems?this.handler.not(".inactive"):this.handler},f.prototype.layoutFull=function(c,d,e){var f,g,h=0,i=0,j=null,k=null,l=[],m=[],n=a.makeArray(this.getActiveItems()),o=n.length,p="left"==this.align?!0:!1;for(this.columns=[],n=this.sortElements(n);l.length<d;)l.push(this.outerOffset),this.columns.push([]);for(;o>h;h++){for(f=a(n[h]),j=l[0],k=0,i=0;d>i;i++)l[i]<j&&(j=l[i],k=i);f.data("wookmark-top",j),g=e,(k>0||!p)&&(g+=k*c),(m[h]={obj:f,css:{position:"absolute",top:j}}).css[this.direction]=g,l[k]+=f.data("wookmark-height")+this.verticalOffset,this.columns[k].push(f)}return b(m),Math.max.apply(Math,l)},f.prototype.layoutColumns=function(a,c){for(var d,e,f,g,h=0,i=0,j=0,k=[],l=[];h<this.columns.length;h++){for(k.push(this.outerOffset),g=this.columns[h],f=h*a+c,d=k[h],i=0;i<g.length;i++,j++)e=g[i].data("wookmark-top",d),(l[j]={obj:e,css:{top:d}}).css[this.direction]=f,d+=e.data("wookmark-height")+this.verticalOffset;k[h]=d}return b(l),Math.max.apply(Math,k)},f.prototype.sortElements=function(a){return"function"==typeof this.comparator?a.sort(this.comparator):a},f.prototype.refreshPlaceholders=function(b,c){for(var d,e,f,g,h,i,j=this.placeholders.length,k=this.columns.length,l=this.container.innerHeight();k>j;j++)h=a('<div class="wookmark-placeholder"/>').appendTo(this.container),this.placeholders.push(h);for(f=this.offset+2*parseInt(this.placeholders[0].css("borderLeftWidth"),10),j=0;j<this.placeholders.length;j++)if(h=this.placeholders[j],g=this.columns[j],j>=k||!g[g.length-1])h.css("display","none");else{if(i=g[g.length-1],!i)continue;e=i.data("wookmark-top")+i.data("wookmark-height")+this.verticalOffset,d=l-e-f,h.css({position:"absolute",display:d>0?"block":"none",left:j*b+c,top:e,width:b-f,height:d})}},f.prototype.clear=function(){clearTimeout(this.resizeTimer),g.unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onRefresh),this.handler.wookmarkInstance=null},f.prototype.filter=function(b,d,e){var f,g,h,i,j,k=[],l=a();if(b=b||[],d=d||"or",e=e||!1,b.length){for(f=0;f<b.length;f++)i=c(b[f]),i in this.filterClasses&&k.push(this.filterClasses[i]);if(j=k.length,"or"==d||1==j)for(f=0;j>f;f++)l=l.add(k[f]);else if("and"==d){var m,n,o,p=k[0],q=!0;for(f=1;j>f;f++)k[f].length<p.length&&(p=k[f]);for(p=p||[],f=0;f<p.length;f++){for(n=p[f],q=!0,g=0;g<k.length&&q;g++)if(o=k[g],p!=o){for(h=0,m=!1;h<o.length&&!m;h++)m=o[h]==n;q&=m}q&&l.push(p[f])}}e||this.handler.not(l).addClass("inactive")}else l=this.handler;return e||(l.removeClass("inactive"),this.columns=null,this.layout()),l},f}(),a.fn.wookmark=function(a){return this.wookmarkInstance?this.wookmarkInstance.update(a||{}):this.wookmarkInstance=new f(this,a||{}),this.wookmarkInstance.layout(!0),this.show()}}(jQuery);